<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Software Asset</title>
    <style>
        * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background-color: #f5f7fa;
    color: #333;
    line-height: 1.6;
}

.dashboard {
    display: flex;
    min-height: 100vh;
}
 /* Sidebar Styles */
 .sidebar {
            width: 250px;
            background: #1e40af;
            color: white;
            padding: 2rem 0;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        }

        .sidebar a {
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .logo {
            padding: 0 1.5rem;
            margin-bottom: 2rem;
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .menu-item {
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: background 0.3s, border-left 0.3s;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .menu-item:hover {
            background: #1e3a8a;
        }

        .menu-item.active {
            background: #1e3a8a;
            border-left: 4px solid white;
        }

    

.main-content {
    flex: 1;
    padding: 1rem;
    background: #ffffff;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.form-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 1rem;
    background: #ffffff;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

h1 {

    font-size: 1.75rem;
    margin-bottom: 1.5rem;
    text-align: center;
}

.form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.form-group {
    position: relative;
}

label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #1e40af;
}

input, select, textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #cbd5e1;
    border-radius: 5px;
    font-size: 1rem;
    transition: border-color 0.3s;
}

input:focus, select:focus, textarea:focus {
    border-color: #1e40af;
    outline: none;
}

button {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 500;
    transition: background 0.3s;
}

.submit-btn {
    background: #1e40af;
    color: white;
}

.submit-btn:hover {
    background: #1e3a8a;
}

.cancel-btn {
    background: #cbd5e1;
    color: #333;
}

.cancel-btn:hover {
    background: #94a3b8;
}

.error-message {
    color: #ef4444;
    font-size: 0.875rem;
    margin-top: 0.5rem;
}

@media screen and (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
}
/* Cost input field with conversion button styling */
.form-group {
    position: relative;
    margin-bottom: 1.5rem;
}

.cost-input-group {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
}

.cost-input-group input#cost {
    flex: 1;
    padding: 0.75rem;
    border: 1px solid #cbd5e1;
    border-radius: 5px;
    font-size: 1rem;
    background-color: #f8fafc;
    cursor: default;
}

.cost-input-group input#cost:focus {
    outline: none;
    border-color: #1e40af;
}

#convert-cost-btn {
    background-color: #1e40af;
    color: white;
    padding: 0.75rem 1.25rem;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 500;
    transition: background-color 0.3s;
    white-space: nowrap;
    flex-shrink: 0;
}

#convert-cost-btn:hover {
    background-color: #1e3a8a;
}

/* Convert Modal */
.convert-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    animation: fadeIn 0.3s;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-content {
    background-color: #fff;
    margin: 10% auto;
    padding: 25px;
    border-radius: 10px;
    width: 350px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    animation: slideDown 0.3s;
}

@keyframes slideDown {
    from { transform: translateY(-50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.modal-content h3 {
    color: #1e40af;
    margin-top: 0;
    margin-bottom: 20px;
    font-weight: 600;
    text-align: center;
}

.modal-content label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #1e40af;
}

.modal-content input,
.modal-content select {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #cbd5e1;
    border-radius: 5px;
    font-size: 14px;
}

.modal-content input:focus,
.modal-content select:focus {
    border-color: #1e40af;
    outline: none;
}

#convert-btn, #save-btn {
    background-color: #1e40af;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    width: 100%;
    margin-top: 10px;
    font-weight: 500;
    transition: background-color 0.3s;
}

#convert-btn:hover, #save-btn:hover {
    background-color: #1e3a8a;
}

#save-btn:disabled {
    background-color: #94a3b8;
    cursor: not-allowed;
}

#converted-cost-display {
    background-color: #f1f5f9;
    padding: 10px;
    border-radius: 5px;
    margin: 15px 0;
    text-align: center;
    font-weight: 500;
}

.close {
    color: #64748b;
    float: right;
    font-size: 28px;
    font-weight: bold;
    line-height: 20px;
    cursor: pointer;
    transition: color 0.3s;
}

.close:hover {
    color: #0f172a;
}
.header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .user-info {
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px; /* Space between avatar and username */
        }

        .user-avatar {
            display: inline-block;
            width: 40px;
            height: 40px;
            background-color: #1e40af;
            color: white;
            text-align: center;
            line-height: 40px;
            border-radius: 50%;
            font-weight: bold;
            transition: transform 0.3s ease;
        }

        .user-name {
            font-weight: bold;
            transition: transform 0.3s ease;
        }
        /* Logout Modal Background */
        .logout-modal {
            display: none; /* Modal should be hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5); /* Dark Overlay */
            z-index: 1000;
            display: flex; /* Flexbox layout to center the modal */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
        }

        /* Logout Modal Box */
        .logout-modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            width: 300px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        /* Logout Modal Buttons */
        .logout-modal-buttons {
            margin-top: 15px;
        }

        .logout-btn {
            background-color: #1e40af;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            margin-right: 10px;
            display: inline-block;
        }

        .logout-btn:hover {
            background-color: #162d79;
        }

        .cancel-btn {
            background-color: #ccc;
            color: black;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .cancel-btn:hover {
            background-color: #bbb;
        }
        .alert-badge {
    display: inline-block;
    margin-left: 8px;
    padding: 0.2rem 0.5rem;
    background-color: #ef4444; /* Red background */
    color: white; /* White text */
    font-size: 0.75rem;
    font-weight: bold;
    border-radius: 9999px; /* Fully rounded corners */
    line-height: 1;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo" style="display: flex; align-items: center; gap: 0.5rem;">
                <img src="/media/assets/images/logo.svg" alt="Logo" style="width: 24px; height: 24px;">
                <span>Asset Manager</span>
              </div>
            <a href="{% url 'dashboard' %}" class="menu-item">
                Dashboard
            </a>
            <a href="{% url 'Asset Inventory' %}" class="menu-item ">
                Asset Inventory
            </a>
            <a href="{% url 'Add Asset' %}" class="menu-item active">
                Add Asset
            </a>
            <a href="{% url 'Alerts' %}" class="menu-item {% if request.resolver_match.url_name == 'Alerts' %}active{% endif %}">
                <div>
                    Alerts
                    {% if total_new_alerts > 0 %}
                        <span class="alert-badge">{{ total_new_alerts }}</span>
                    {% endif %}
                </div>
            </a>
            <a href="{% url 'MaintenancePage' %}" class="menu-item">
                Maintenance
            </a>
            <a href="{% url 'asset_request_tracking' %}" class="menu-item">
                Asset Requests
            </a>
            <a href="{% url 'Reports' %}" class="menu-item">
                Reports
            </a>
            <a href="{% url 'user_management' %}" class="menu-item ">
                <div>Users</div>
            </a>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1 style="color: black;">Add Software Asset</h1>
               
                <div class="user-info" onclick="openLogoutModal()">
                    <span class="user-name">{{ user.username }}</span>
                    <div class="user-avatar">
                        {{ user.email.0|upper }}{{ user.email.1|lower }}
                    </div>
                </div>
            </div>
            
            <!-- Logout Pop-up Modal -->
            <div id="logoutModal" class="logout-modal">
                <div class="logout-modal-content">
                    <p>Are you sure you want to logout?</p>
                    <div class="logout-modal-buttons">
                        <a href="{% url 'logout' %}" class="logout-btn">Logout</a>
                        <button onclick="closeLogoutModal()" class="cancel-btn">Cancel</button>
                    </div>
                </div>
            </div>
            <div class="form-container">
              
                <form method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <!-- Software Name and Version -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="id_AssetName">Software Name</label>
                            {{ form.AssetName }}
                            {% if form.AssetName.errors %}
                                <div class="error-message">{{ form.AssetName.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label for="id_SoftwareVersion">Software Version</label>
                            {{ form.SoftwareVersion }}
                            {% if form.SoftwareVersion.errors %}
                                <div class="error-message">{{ form.SoftwareVersion.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Category and Asset Provider -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="id_Category">Category</label>
                            {{ form.Category }}
                            {% if form.Category.errors %}
                                <div class="error-message">{{ form.Category.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label for="id_AssetProvider">Asset Provider</label>
                            {{ form.AssetProvider }}
                            {% if form.AssetProvider.errors %}
                                <div class="error-message">{{ form.AssetProvider.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Purchase Date and Renew Date -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="id_PurchaseDate">Purchase Date</label>
                            {{ form.PurchaseDate }}
                            {% if form.PurchaseDate.errors %}
                                <div class="error-message">{{ form.PurchaseDate.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label for="id_RenewDate">Renew Date</label>
                            {{ form.RenewDate }}
                            {% if form.RenewDate.errors %}
                                <div class="error-message">{{ form.RenewDate.errors }}</div>
                            {% endif %}
                        </div>
                    </div>  
                    <!-- Cost -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cost" class="required-field">Cost:</label>
                            <div class="cost-input-group">
                                <input type="number" id="cost" name="Cost" readonly>
                                <button type="button" id="convert-cost-btn">Convert Cost</button>
                            </div>

                            <!-- Modal -->
                            <div id="convert-modal" class="convert-modal">
                                <div class="modal-content">
                                    <span class="close">&times;</span>
                                    <h3>Enter Cost Details</h3>
                                    <label for="input-cost">Cost:</label>
                                    <input type="number" id="input-cost" placeholder="Enter cost">

                                    <label for="input-currency">Currency:</label>
                                    <select id="input-currency">
                                        <option value="USD">USD</option>
                                        <option value="EUR">EUR</option>
                                        <option value="INR" selected>INR</option>
                                    </select>

                                    <button type="button" id="convert-btn">Convert to INR</button>
                                    <p id="converted-cost-display"></p>
                                    <button type="button" id="save-btn" disabled>Save to Cost Field</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div style="text-align: right; margin-top: 2rem;">
                        <button type="button" class="cancel-btn">Cancel</button>
                        <button type="submit" class="submit-btn">Add Asset</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
<script>
     document.addEventListener("DOMContentLoaded", function() {
            // Ensure the modal is hidden when the page loads
            document.getElementById("logoutModal").style.display = "none";
        });

        // Open modal when avatar or username is clicked
        function openLogoutModal() {
            document.getElementById("logoutModal").style.display = "flex"; // Show modal
        }

        // Close modal when user clicks outside the modal content
        function closeLogoutModal() {
            document.getElementById("logoutModal").style.display = "none"; // Hide modal
        }

        // Close logout modal if user clicks outside the modal box
        window.onclick = function(event) {
            let logoutModal = document.getElementById("logoutModal");
            // Check if the click happened outside of the modal content (to close it)
            if (event.target === logoutModal) {
                logoutModal.style.display = "none"; // Close modal
            }
        }

    document.addEventListener("DOMContentLoaded", function () {
            const convertModal = document.querySelector(".convert-modal");
            const closeModal = document.getElementsByClassName("close")[0];
            const convertCostBtn = document.getElementById("convert-cost-btn");
            const convertBtn = document.getElementById("convert-btn");
            const saveBtn = document.getElementById("save-btn");
            const costInput = document.getElementById("cost");
            const inputCost = document.getElementById("input-cost");
            const inputCurrency = document.getElementById("input-currency");
            const purchaseDate = document.getElementById("id_PurchaseDate"); // Purchase date input
            const convertedCostDisplay = document.getElementById("converted-cost-display");

            // Function to fetch exchange rate from Frankfurter API
            async function fetchExchangeRate(baseCurrency, targetCurrency, date) {
                try {
                    const response = await fetch(
                        `https://api.frankfurter.app/${date}?from=${baseCurrency}&to=${targetCurrency}`
                    );
                    if (!response.ok) {
                        throw new Error("Failed to fetch exchange rate.");
                    }
                    const data = await response.json();
                    if (data.rates && data.rates[targetCurrency]) {
                        return data.rates[targetCurrency]; // Return the exchange rate for the target currency
                    } else {
                        throw new Error("Invalid currency or no data available for the given date.");
                    }
                } catch (error) {
                    console.error("Error fetching exchange rate:", error);
                    return null;
                }
            }

            // Open modal and pre-fill purchase date
            convertCostBtn.onclick = function () {
                convertModal.style.display = "block";
                inputCost.focus(); // Focus on the cost input field

                // Pre-fill the purchase date from the main form
                if (purchaseDate) {
                    const purchaseDateValue = purchaseDate.value;
                    if (!purchaseDateValue) {
                        alert("Please select a purchase date before converting the cost.");
                        convertModal.style.display = "none";
                        return;
                    }
                }
            };

            // Close modal
            closeModal.onclick = function () {
                convertModal.style.display = "none";
                inputCost.value = ""; // Clear cost input
                inputCurrency.value = "INR"; // Reset currency to default
                convertedCostDisplay.textContent = ""; // Clear converted cost display
                saveBtn.disabled = true; // Disable save button
            };

            // Handle outside click to close modal
            window.onclick = function (event) {
                if (event.target === convertModal) {
                    closeModal.click(); // Trigger close logic
                }
            };

            // Convert to INR
            convertBtn.onclick = async function () {
                const cost = parseFloat(inputCost.value) || 0;
                const currency = inputCurrency.value;

                if (cost <= 0) {
                    convertedCostDisplay.textContent = "Please enter a valid cost greater than zero.";
                    saveBtn.disabled = true; // Disable save button
                    return;
                }

                if (currency === "INR") {
                    convertedCostDisplay.textContent = `Cost in INR: ${cost.toFixed(2)} INR`;
                    saveBtn.disabled = false; // Enable save button
                    return;
                }

                // Fetch purchase date from the main form
                const purchaseDateValue = purchaseDate ? purchaseDate.value : "";
                if (!purchaseDateValue) {
                    convertedCostDisplay.textContent = "Please select a purchase date.";
                    saveBtn.disabled = true; // Disable save button
                    return;
                }

                // Show loading state
                convertedCostDisplay.textContent = "Converting...";

                // Fetch exchange rate for the specified date
                const exchangeRate = await fetchExchangeRate(currency, "INR", purchaseDateValue);

                if (exchangeRate !== null) {
                    const costInINR = cost * exchangeRate;
                    convertedCostDisplay.textContent = `Cost in INR: ${costInINR.toFixed(2)} INR`;
                    saveBtn.disabled = false; // Enable save button
                } else {
                    convertedCostDisplay.textContent = "Failed to fetch exchange rate.";
                    saveBtn.disabled = true; // Disable save button
                }
            };

            // Save to cost field
            saveBtn.onclick = function () {
                const costInINRText = convertedCostDisplay.textContent.split(": ")[1];
                if (costInINRText) {
                    const costInINR = parseFloat(costInINRText.replace(" INR", "")); // Remove " INR" and parse as float
                    if (!isNaN(costInINR)) {
                        costInput.value = costInINR; // Set numeric value
                    } else {
                        alert("Failed to save the converted cost.");
                    }
                }
                convertModal.style.display = "none"; // Close modal
            };
        });
        
</script>
</html>